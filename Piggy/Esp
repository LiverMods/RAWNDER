pcall(function()
	game.StarterGui:SetCore("SendNotification", {
		Title = "Attention",
		Text = "Turn it off when the match is over!",
		Duration = 60
	})
end)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local enabled = false
local fillTransparency = 0.87
local outlineTransparency = 0.1
local uselocalplayer = false
local ignoredNames = { "Bess", "Ombra", "MrBliss" }

local function randomString()
	local length = math.random(17, 45)
	local array = {}
	for i = 1, length do
		array[i] = string.char(math.random(32, 126))
	end
	return table.concat(array)
end

local function encryptNames(target)
	if typeof(target) ~= "Instance" then return end
	for _, descendant in ipairs(target:GetDescendants()) do
		if descendant:IsA("Instance") then
			descendant.Name = randomString()
		end
	end
	target.Name = randomString()
end

local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = randomString()
local frame = Instance.new("Frame", gui)
frame.Name = randomString()
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.Position = UDim2.new(0.4, 0, 0.35, 0)
frame.Size = UDim2.new(0, 90, 0, 65)
frame.Active = true
frame.Draggable = true

local label = Instance.new("TextLabel", frame)
label.Size = UDim2.new(1, 0, 0, 20)
label.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
label.Font = Enum.Font.SourceSans
label.Text = "ESP gui V5"
label.TextColor3 = Color3.fromRGB(0, 99, 390)
label.TextScaled = true

local toggle = Instance.new("TextButton", frame)
toggle.Position = UDim2.new(0.05, 0, 0.4, 0)
toggle.Size = UDim2.new(0, 82, 0, 34)
toggle.BackgroundColor3 = Color3.fromRGB(32, 32, 32)
toggle.Font = Enum.Font.Kalam
toggle.Text = "OFF"
toggle.TextColor3 = Color3.fromRGB(49, 180, 198)
toggle.TextSize = 22

local function createOrUpdateESP(model)
	if not model or not model:IsA("Model") then return end
	if table.find(ignoredNames, model.Name) then return end
	if not model:FindFirstChild("Humanoid") then return end
	if model == LocalPlayer.Character and not uselocalplayer then return end

	local folder = game.CoreGui:FindFirstChildWhichIsA("Folder") or Instance.new("Folder", game.CoreGui)
	folder.Name = folder.Name or randomString()

	local esp = folder:FindFirstChild(model.Name)
	if not esp then
		esp = Instance.new("Highlight", folder)
		esp.Name = model.Name
	end

	esp.FillColor = Color3.new(0, 1, 0)
	esp.OutlineColor = Color3.new(0, 1, 0)

	if model:FindFirstChild("Enemy") and not model:FindFirstChild("IsActive") then
		esp.FillColor = Color3.new(1, 0, 0)
		esp.OutlineColor = Color3.new(1, 0, 0)
		
	elseif model:FindFirstChild("IsActive") then
		esp.FillColor = Color3.new(1, 1, 0)
		esp.OutlineColor = Color3.new(1, 1, 0)
		
	elseif model:FindFirstChild("Traitor") and not model:FindFirstChild("IsActive") then
		task.spawn(function()
			esp.FillColor = Color3.new(1, 0, 0)
			esp.OutlineColor = Color3.new(1, 0, 0)
			task.wait(0.5)
			esp.FillColor = Color3.new(0, 1, 0)
			esp.OutlineColor = Color3.new(0, 1, 0)
		end)
	end

	esp.FillTransparency = fillTransparency
	esp.OutlineTransparency = outlineTransparency
	esp.Adornee = model
	esp.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop

	encryptNames(folder)
end

local function refreshAll()
	if not enabled then return end

	for _, obj in ipairs(workspace:GetDescendants()) do
		if obj:IsA("Model") and obj:FindFirstChild("Humanoid") then
			createOrUpdateESP(obj)
		end
	end
end

local updateConnection
toggle.MouseButton1Click:Connect(function()
	enabled = not enabled
	toggle.Text = enabled and "ON" or "OFF"

	local folder = game.CoreGui:FindFirstChildWhichIsA("Folder")
	if not enabled and folder then
		folder:Destroy()
	end

	if enabled then
		refreshAll()
		if updateConnection then updateConnection:Disconnect() end
		updateConnection = RunService.RenderStepped:Connect(refreshAll)
	else
		if updateConnection then updateConnection:Disconnect() end
	end
end)

game.Players.PlayerAdded:Connect(function(plr)
	plr.CharacterAdded:Connect(function(char)
		if enabled then createOrUpdateESP(char) end
	end)
end)

task.spawn(function()
	while true do
		encryptNames(gui)
		task.wait(10)
	end
end)
